

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Compiling AMReX with CVODE &mdash; amrex 10.17 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="amrex 10.17 documentation" href="index.html"/>
        <link rel="up" title="CVODE" href="Chapter13.html"/>
        <link rel="prev" title="CVODE" href="Chapter13.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> amrex
          

          
          </a>

          
            
            
              <div class="version">
                10.17
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">AMReX Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter2.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter3.html">Building AMReX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter4.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Boundary.html">Boundary Conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter6.html">AmrCore Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter7.html">Amr Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter8.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter9.html">Fortran Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter10.html">Embedded Boundaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter11.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter12.html">Profiling</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Chapter13.html">CVODE</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Compiling AMReX&nbsp;with CVODE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-cvode-tutorials">The CVODE&nbsp;Tutorials</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amrex</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="Chapter13.html">CVODE</a> &raquo;</li>
        
      <li>Compiling AMReX&nbsp;with CVODE</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/CVODE.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compiling-amrex-with-cvode">
<h1>Compiling AMReX&nbsp;with CVODE<a class="headerlink" href="#compiling-amrex-with-cvode" title="Permalink to this headline">¶</a></h1>
<p>The following steps describe how to compile an AMReX&nbsp;application with
CVODE&nbsp;support.  On Cray systems (e.g., Cori or Edison at NERSC), Cray provides
a system module called <code class="docutils literal"><span class="pre">cray-tpsl</span></code> (“Cray Third-Party Scientific Libraries”)
which contains the latest version of the SUNDIALS&nbsp;solver suite (including
CVODE).  Simply type <code class="docutils literal"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">cray-tpsl</span></code> and set <code class="docutils literal"><span class="pre">USE_CVODE=TRUE</span></code> in
the <code class="docutils literal"><span class="pre">GNUmakefile</span></code>, and AMReX&nbsp;will automatically link the SUNDIALS&nbsp;libraries.</p>
<p>On systems which are not Cray:</p>
<ol class="arabic">
<li><p class="first">Obtain the CVODE&nbsp;source code, which is hosted here:
<a class="reference external" href="https://computation.llnl.gov/projects/sundials/sundials-software">https://computation.llnl.gov/projects/sundials/sundials-software</a>.
One can download either the complete SUNDIALS&nbsp;package, or just the CVODE&nbsp;components.</p>
</li>
<li><p class="first">Unpack the CVODE / SUNDIALS&nbsp;tarball, and create a new “build” directory (it
can be anywhere).</p>
</li>
<li><p class="first">Navigate to the new, empty build directory, and type</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cmake</span> \
  <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="p">:</span><span class="n">PATH</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="nb">dir</span> \
  <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cvode</span><span class="o">/</span><span class="ow">or</span><span class="o">/</span><span class="n">sundials</span><span class="o">/</span><span class="n">top</span><span class="o">/</span><span class="n">level</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="nb">dir</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">CMAKE_INSTALL_DIR</span></code> option tells CMake where to install the libraries.
Note that CMake will attempt to deduce the compilers automatically, but
respects certain environment variables if they are defined, such as <code class="docutils literal"><span class="pre">CC</span></code>
(for the C compiler), <code class="docutils literal"><span class="pre">CXX</span></code> (for the C++ compiler), and <code class="docutils literal"><span class="pre">FC</span></code> (for the
Fortran compiler).  So one may modify the above CMake invocation to be
something like the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CC</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">gcc</span> \
<span class="n">CXX</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">g</span><span class="o">++</span> \
<span class="n">FC</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">gfortran</span> \
  <span class="n">cmake</span> \
  <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="p">:</span><span class="n">PATH</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="nb">dir</span> \
  <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cvode</span><span class="o">/</span><span class="ow">or</span><span class="o">/</span><span class="n">sundials</span><span class="o">/</span><span class="n">top</span><span class="o">/</span><span class="n">level</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="nb">dir</span>
</pre></div>
</div>
<p>One can supply additional flags to CMake or to the compiler to customize the
compilation process.  Flags of interest may include <code class="docutils literal"><span class="pre">CMAKE_C_FLAGS</span></code>, which
add the specified flags to the compile statement, e.g.,
<code class="docutils literal"><span class="pre">-DCMAKE_C_FLAGS=&quot;-h</span> <span class="pre">list=a&quot;</span></code> will append the <code class="docutils literal"><span class="pre">-h</span> <span class="pre">list=a</span></code> flag to the
<code class="docutils literal"><span class="pre">cc</span></code> statement when compiling the source code.  Here one may wish to add
something like <code class="docutils literal"><span class="pre">&quot;-O2</span> <span class="pre">-g&quot;</span></code> to provide an optimized library that still
contains debugging symbols; if one neglects debugging symbols in the CVODE
library, and if a code that uses CVODE&nbsp;encounters a segmentation fault in
the solve, then the backtrace has no information about where in the solver
the error occurred.  Also, if one wishes to compile only the solver library
itself and not the examples that come with the source (compiling the
examples is enabled by default), one can add <code class="docutils literal"><span class="pre">&quot;-DEXAMPLES_ENABLE=OFF&quot;</span></code>.
Users should be aware that the CVODE&nbsp;examples are linked dynamically, so
when compiling the solver library on Cray system using the Cray compiler
wrappers <code class="docutils literal"><span class="pre">cc</span></code>, <code class="docutils literal"><span class="pre">CC</span></code>, and <code class="docutils literal"><span class="pre">ftn</span></code>, one should explicitly disable
compiling the examples via the <code class="docutils literal"><span class="pre">&quot;-DEXAMPLES_ENABLE=OFF&quot;</span></code> flag.</p>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">GNUmakefile</span></code> for the &nbsp;application which uses the Fortran 2003
interface to , add <code class="docutils literal"><span class="pre">USE_CVODE</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>, which will compile the Fortran 2003
interfaces and link the &nbsp;libraries.  Note that one must define the
<code class="docutils literal"><span class="pre">CVODE_LIB_DIR</span></code> environment variable to point to the location where the
libraries are installed.</p>
</li>
</ol>
</div>
<div class="section" id="the-cvode-tutorials">
<h1>The CVODE&nbsp;Tutorials<a class="headerlink" href="#the-cvode-tutorials" title="Permalink to this headline">¶</a></h1>
<p>&nbsp;provides two CVODE&nbsp;tutorials in the <code class="docutils literal"><span class="pre">Tutorials/CVODE</span></code> directory, called
<code class="docutils literal"><span class="pre">EX1</span></code> and <code class="docutils literal"><span class="pre">EX2</span></code>.  <code class="docutils literal"><span class="pre">EX1</span></code> consists of a single ODE that is integrated with
CVODE&nbsp;within each cell of a 3-D grid.  It demonstrates how to initialize the
CVODE&nbsp;solver, how to call the ODE right-hand-side (RHS), and, more importantly,
how to <em>re-</em>initialize the solver between cells, which avoids allocating and
freeing solver memory between each cell (see the call to <code class="docutils literal"><span class="pre">FCVReInit()</span></code> in the
<code class="docutils literal"><span class="pre">integrate_ode.f90</span></code> file in the <code class="docutils literal"><span class="pre">EX1</span></code> directory.)</p>
<p>The <code class="docutils literal"><span class="pre">EX2</span></code> example demonstrates the slightly more complicated case of
integrating a system of coupled ODEs within each cell.  Similarly to <code class="docutils literal"><span class="pre">EX1</span></code>,
it provides an RHS and some solver initialization.  However, it also
demonstrates the performance effect of providing an analytic Jacobian matrix
for the system of ODEs, rather than requiring the &nbsp;solver to compute the
Jacobian matrix numerically using a finite-difference approach.  The tutorial
integrates the same system of ODEs on the same 3-D grid, but in one sweep it
instructs CVODE&nbsp;to use the analytic function that computes the Jacobian matrix,
and in the other case, it does not, which requires CVODE&nbsp;to compute it
manually.  One observes a significant performance gain by providing the
analytic Jacobian function.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="Chapter13.html" class="btn btn-neutral" title="CVODE" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, AMReX Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'10.17',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>